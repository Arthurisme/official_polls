!function(){function t(){return"ontouchstart"in window||"onmsgesturechange"in window}function i(t,i,e){return e>t+i&&(t=e-i),t>0?0:t}function e(t){for(var i=t.split(","),e=atob(i[1]),o=i[0].split(":")[1].split(";")[0],n=new ArrayBuffer(e.length),h=new Uint8Array(n),s=0;s<e.length;s++)h[s]=e.charCodeAt(s);return new Blob([n],{type:o})}function o(o){function s(t,i,e){this.width=null,this.height=null,this.img_width=null,this.img_height=null,this.img_left=0,this.img_top=0,this.minPercent=null,this.options=i,this.$image=t,this.$image.hide().prop("draggable",!1).addClass("cropImage").wrap('<div class="cropFrame" />'),this.$frame=this.$image.parent(),this.on_load=e||function(){},this.init()}s.prototype={init:function(){var t=this,i=o("<div/>",{"class":"cropControls"}).append(o("<span>"+this.options.label+"</span>")).append(o("<button/>",{"class":"cropZoomIn",type:"button"}).on("click",o.proxy(this.zoomIn,this))).append(o("<button/>",{"class":"cropZoomOut",type:"button"}).on("click",o.proxy(this.zoomOut,this)));if(this.$frame.append(this.options.controls||i),this.updateOptions(),"function"==typeof o.fn.hammer||"undefined"!=typeof Hammer){var e,n;e="function"==typeof o.fn.hammer?this.$image.hammer().data("hammer"):Hammer(this.$image.get(0)),e.get("pan").set({direction:Hammer.DIRECTION_ALL,threshold:0}),e.get("pinch").set({enable:!0}),e.on("panleft panright panup pandown",function(i){n||(n={startX:t.img_left,startY:t.img_top}),n.dx=i.deltaX,n.dy=i.deltaY,i.preventDefault(),t.drag.call(t,n,!0)}).on("panend pancancel",function(i){i.preventDefault(),n=null,t.update.call(t)}).on("doubletap",function(i){i.preventDefault(),t.zoomIn.call(t)}).on("pinchin",function(i){i.preventDefault(),t.zoomOut.call(t)}).on("pinchout",function(i){i.preventDefault(),t.zoomIn.call(t)})}else this.$image.on("dragstart",function(){return!1}),this.$image.on("mousedown."+h,function(i){var e={startX:t.img_left,startY:t.img_top};i.preventDefault(),o(document).on("mousemove."+h,function(o){e.dx=o.pageX-i.pageX,e.dy=o.pageY-i.pageY,t.drag.call(t,e,!0)}).on("mouseup."+h,function(){t.update.call(t),o(document).off("mouseup."+h),o(document).off("mousemove."+h)})});o.fn.mousewheel&&this.$image.on("mousewheel."+h,function(i){i.preventDefault(),i.deltaY<0?t.zoomIn.call(t):t.zoomOut.call(t)})},updateOptions:function(){var i=this;i.img_top=0,i.img_left=0,i.$image.css({width:"",left:i.img_left,top:i.img_top}),i.$frame.width(i.options.width).height(i.options.height),i.$frame.off("."+h),i.$frame.removeClass("hover"),"always"===i.options.showControls||"auto"===i.options.showControls&&t()?i.$frame.addClass("hover"):"never"!==i.options.showControls&&(i.$frame.on("mouseenter."+h,function(){i.$frame.addClass("hover")}),i.$frame.on("mouseleave."+h,function(){i.$frame.removeClass("hover")}));var e=new Image;e.onload=function(){i.width=e.width,i.height=e.height,e.src="",e.onload=null,i.percent=void 0,i.fit.call(i),i.options.result?i.setCrop.call(i,i.options.result):i.zoom.call(i,i.minPercent),i.$image.fadeIn("fast"),i.on_load.call(i)},e.src=i.$image.attr("src")},remove:function(){var t;"function"==typeof o.fn.hammer?t=this.$image.data("hammer"):"undefined"!=typeof Hammer&&(t=Hammer(this.$image.get(0))),t&&t.off("panleft panright panup pandown panend pancancel doubletap pinchin pinchout"),this.$frame.off("."+h),this.$image.off("."+h),this.$image.css({width:"",left:"",top:""}),this.$image.removeClass("cropImage"),this.$image.removeData(h),this.$image.insertAfter(this.$frame),this.$frame.removeClass("cropFrame"),this.$frame.removeAttr("style"),this.$frame.empty(),this.$frame.remove()},fit:function(){var t=this.options.width/this.width,i=this.options.height/this.height;this.minPercent=t>=i?t:i},setCrop:function(t){this.percent=Math.max(this.options.width/t.cropW,this.options.height/t.cropH),this.img_width=Math.ceil(this.width*this.percent),this.img_height=Math.ceil(this.height*this.percent),this.img_left=-Math.floor(t.cropX*this.percent),this.img_top=-Math.floor(t.cropY*this.percent),this.$image.css({width:this.img_width,left:this.img_left,top:this.img_top}),this.update()},zoom:function(t){var e=this.percent;if(this.percent=Math.max(this.minPercent,Math.min(this.options.maxZoom,t)),this.img_width=Math.ceil(this.width*this.percent),this.img_height=Math.ceil(this.height*this.percent),e){var o=this.percent/e;this.img_left=i((1-o)*this.options.width/2+o*this.img_left,this.img_width,this.options.width),this.img_top=i((1-o)*this.options.height/2+o*this.img_top,this.img_height,this.options.height)}else this.img_left=i((this.options.width-this.img_width)/2,this.img_width,this.options.width),this.img_top=i((this.options.height-this.img_height)/2,this.img_height,this.options.height);this.$image.css({width:this.img_width,left:this.img_left,top:this.img_top}),this.update()},zoomIn:function(){this.zoom(this.percent+(1-this.minPercent)/(this.options.zoom-1||1))},zoomOut:function(){this.zoom(this.percent-(1-this.minPercent)/(this.options.zoom-1||1))},drag:function(t,e){this.img_left=i(t.startX+t.dx,this.img_width,this.options.width),this.img_top=i(t.startY+t.dy,this.img_height,this.options.height),this.$image.css({left:this.img_left,top:this.img_top}),e||this.update()},update:function(){this.result={cropX:-Math.ceil(this.img_left/this.percent),cropY:-Math.ceil(this.img_top/this.percent),cropW:Math.floor(this.options.width/this.percent),cropH:Math.floor(this.options.height/this.percent),stretch:this.minPercent>1},this.$image.trigger(h,[this.result,this])},getDataURL:function(){if(!n)return!1;var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=this.options.width,t.height=this.options.height,i.drawImage(this.$image.get(0),this.result.cropX,this.result.cropY,this.result.cropW,this.result.cropH,0,0,this.options.width,this.options.height),t.toDataURL()},getBlob:function(){return e(this.getDataURL())}},o.fn[h]=function(t,i){return this.each(function(){var e=o(this),n=e.data(h);if(n)t&&(o.extend(n.options,t),n.updateOptions());else{var a=o.extend({},o.fn[h].defaultOptions,t);e.data(h,new s(e,a,i))}})},o.fn[h].defaultOptions={width:200,height:200,zoom:10,maxZoom:1,controls:null,showControls:"auto",label:"Drag to crop"}}var n=document.createElement("canvas");n=!(!n.getContext||!n.getContext("2d"));var h="cropbox";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?o(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],o):o(window.jQuery||window.Zepto)}();